<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTM Builder Pro - Marketing URL Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF0000;
            --primary-dark: #CC0000;
            --secondary: #1473E6;
            --background: #0a0a0a;
            --surface: #1a1a1a;
            --surface-hover: #2a2a2a;
            --text: #ffffff;
            --text-secondary: #a0a0a0;
            --border: #333333;
            --success: #00d4aa;
            --warning: #ffb000;
            --gradient: linear-gradient(135deg, #FF0000 0%, #1473E6 100%);
            --glass: rgba(255, 255, 255, 0.05);
            --blur: blur(20px);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background: var(--gradient);
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.3;
            z-index: -1;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -2px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .form-section {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .form-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        .preview-section {
            background: var(--glass);
            backdrop-filter: var(--blur);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            position: sticky;
            top: 20px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 0.95rem;
        }

        .required {
            color: var(--primary);
        }

        input, select {
            width: 100%;
            padding: 15px 20px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        input:hover, select:hover {
            border-color: var(--text-secondary);
        }

        .input-group {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .preset-btn {
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .preset-btn:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            color: var(--text);
            transform: translateY(-1px);
        }

        .url-preview {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .url-preview.empty {
            color: var(--text-secondary);
            font-style: italic;
            font-family: inherit;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex: 1;
            min-width: 120px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .qr-container {
            text-align: center;
            margin-bottom: 25px;
        }

        #qrcode {
            background: white;
            padding: 20px;
            border-radius: 12px;
            display: inline-block;
            margin: 10px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .url-history {
            margin-top: 30px;
        }

        .history-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .history-item:hover {
            background: var(--surface-hover);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .history-url {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            word-break: break-all;
            margin-bottom: 5px;
        }

        .history-meta {
            font-size: 0.75rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .bulk-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid var(--border);
        }

        .bulk-textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            resize: vertical;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .preview-section {
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .form-section, .preview-section {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                min-width: auto;
            }
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.3;
        }

        .advanced-options {
            margin-top: 20px;
            padding: 20px;
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 5px 0;
            margin-bottom: 15px;
        }

        .toggle-btn:hover {
            text-decoration: underline;
        }

        .advanced-content {
            display: none;
        }

        .advanced-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .url-shortener {
            margin-top: 15px;
            padding: 15px;
            background: var(--surface);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .template-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .template-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-card:hover {
            border-color: var(--primary);
            background: var(--surface-hover);
            transform: translateY(-2px);
        }

        .template-card.active {
            border-color: var(--primary);
            background: rgba(255, 0, 0, 0.1);
        }

        .template-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .template-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="floating-particles"></div>
    
    <div class="container">
        <header class="header">
            <h1>UTM Builder Pro</h1>
            <p class="subtitle">Professional URL tracking for marketing campaigns with advanced analytics and team collaboration</p>
        </header>

        <div class="template-selector">
            <div class="template-card active" data-template="custom">
                <div class="template-name">Custom Campaign</div>
                <div class="template-desc">Build from scratch</div>
            </div>
            <div class="template-card" data-template="email">
                <div class="template-name">Email Marketing</div>
                <div class="template-desc">Newsletter campaigns</div>
            </div>
            <div class="template-card" data-template="social">
                <div class="template-name">Social Media</div>
                <div class="template-desc">Facebook, Twitter, LinkedIn</div>
            </div>
            <div class="template-card" data-template="ppc">
                <div class="template-name">Paid Advertising</div>
                <div class="template-desc">Google Ads, Facebook Ads</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="form-section">
                <h2 style="margin-bottom: 25px; font-size: 1.5rem;">Campaign Details</h2>
                
                <div class="form-group">
                    <label for="baseUrl">Website URL <span class="required">*</span></label>
                    <div class="input-group">
                        <input type="url" id="baseUrl" placeholder="https://yourwebsite.com/page" required>
                        <span class="input-icon">üåê</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="campaign">Campaign Name <span class="required">*</span></label>
                    <div class="input-group">
                        <input type="text" id="campaign" placeholder="summer_sale_2024" required>
                        <span class="input-icon">üéØ</span>
                    </div>
                    <div class="preset-buttons" id="campaignPresets"></div>
                </div>

                <div class="form-group">
                    <label for="source">Traffic Source <span class="required">*</span></label>
                    <div class="input-group">
                        <input type="text" id="source" placeholder="google, facebook, newsletter" required>
                        <span class="input-icon">üìä</span>
                    </div>
                    <div class="preset-buttons" id="sourcePresets"></div>
                </div>

                <div class="form-group">
                    <label for="medium">Marketing Medium <span class="required">*</span></label>
                    <div class="input-group">
                        <input type="text" id="medium" placeholder="cpc, email, social" required>
                        <span class="input-icon">üì±</span>
                    </div>
                    <div class="preset-buttons" id="mediumPresets"></div>
                </div>

                <div class="advanced-options">
                    <button class="toggle-btn" onclick="toggleAdvanced()">‚öôÔ∏è Advanced Options</button>
                    <div class="advanced-content" id="advancedContent">
                        <div class="form-group">
                            <label for="term">Keyword/Term</label>
                            <input type="text" id="term" placeholder="running shoes, summer sale">
                        </div>

                        <div class="form-group">
                            <label for="content">Ad Content</label>
                            <input type="text" id="content" placeholder="banner_ad, text_link">
                        </div>

                        <div class="form-group">
                            <label for="customParam">Custom Parameter</label>
                            <input type="text" id="customParam" placeholder="custom_value">
                        </div>
                    </div>
                </div>

                <div class="bulk-section">
                    <h3 style="margin-bottom: 15px;">Bulk URL Generation</h3>
                    <textarea class="bulk-textarea" id="bulkUrls" placeholder="Paste multiple base URLs (one per line) to generate UTM URLs in bulk..."></textarea>
                    <button class="btn btn-secondary" onclick="generateBulkUrls()" style="margin-top: 10px; width: 100%;">Generate Bulk URLs</button>
                </div>
            </div>

            <div class="preview-section">
                <h2 style="margin-bottom: 20px; font-size: 1.5rem;">Live Preview</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="urlCount">0</span>
                        <span class="stat-label">URLs Created</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="campaignCount">0</span>
                        <span class="stat-label">Campaigns</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="urlLength">0</span>
                        <span class="stat-label">Characters</span>
                    </div>
                </div>

                <div class="url-preview" id="urlPreview">
                    Enter your campaign details to see the UTM URL preview
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="copyUrl()">üìã Copy URL</button>
                    <button class="btn btn-secondary" onclick="shareUrl()">üì§ Share</button>
                </div>

                <div class="qr-container">
                    <h3 style="margin-bottom: 15px;">QR Code</h3>
                    <div id="qrcode"></div>
                    <button class="btn btn-secondary" onclick="downloadQR()" style="margin-top: 10px;">Download QR</button>
                </div>

                <div class="export-options">
                    <button class="btn btn-secondary" onclick="exportCSV()">üìä Export CSV</button>
                    <button class="btn btn-secondary" onclick="exportJSON()">üìÑ Export JSON</button>
                    <button class="btn btn-secondary" onclick="exportPDF()">üìë Export PDF</button>
                </div>

                <div class="url-history">
                    <h3 style="margin-bottom: 15px;">Recent URLs</h3>
                    <div id="historyContainer"></div>
                    <button class="btn btn-secondary" onclick="clearHistory()" style="width: 100%; margin-top: 10px;">Clear History</button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Global state management
        let urlHistory = JSON.parse(localStorage.getItem('utmHistory') || '[]');
        let currentQR = null;
        let stats = JSON.parse(localStorage.getItem('utmStats') || '{"urlCount": 0, "campaignCount": 0}');

        // Template configurations
        const templates = {
            custom: {
                campaign: '',
                source: '',
                medium: ''
            },
            email: {
                campaign: 'newsletter',
                source: 'email',
                medium: 'email'
            },
            social: {
                campaign: 'social_campaign',
                source: 'facebook',
                medium: 'social'
            },
            ppc: {
                campaign: 'paid_ads',
                source: 'google',
                medium: 'cpc'
            }
        };

        // Preset options for quick selection
        const presets = {
            campaign: ['spring_sale', 'black_friday', 'new_product_launch', 'webinar_promo', 'holiday_campaign'],
            source: ['google', 'facebook', 'twitter', 'linkedin', 'instagram', 'email', 'direct', 'referral'],
            medium: ['cpc', 'email', 'social', 'organic', 'referral', 'display', 'affiliate', 'video']
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            createFloatingParticles();
            loadHistory();
            updateStats();
        });

        function initializeApp() {
            // Create preset buttons
            createPresetButtons();
            
            // Add event listeners
            document.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('input', updatePreview);
            });

            // Template selector event listeners
            document.querySelectorAll('.template-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectTemplate(this.dataset.template);
                });
            });

            // Initial preview update
            updatePreview();
        }

        function createPresetButtons() {
            Object.keys(presets).forEach(type => {
                const container = document.getElementById(type + 'Presets');
                presets[type].forEach(preset => {
                    const button = document.createElement('button');
                    button.className = 'preset-btn';
                    button.textContent = preset;
                    button.onclick = () => {
                        document.getElementById(type).value = preset;
                        updatePreview();
                        animateButton(button);
                    };
                    container.appendChild(button);
                });
            });
        }

        function selectTemplate(templateType) {
            // Update active template
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`[data-template="${templateType}"]`).classList.add('active');

            // Apply template values
            const template = templates[templateType];
            Object.keys(template).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = template[key];
                }
            });

            updatePreview();
            showNotification(`Applied ${templateType} template`);
        }

        function updatePreview() {
            const baseUrl = document.getElementById('baseUrl').value;
            const campaign = document.getElementById('campaign').value;
            const source = document.getElementById('source').value;
            const medium = document.getElementById('medium').value;
            const term = document.getElementById('term').value;
            const content = document.getElementById('content').value;
            const customParam = document.getElementById('customParam').value;

            if (!baseUrl) {
                document.getElementById('urlPreview').innerHTML = 'Enter your campaign details to see the UTM URL preview';
                document.getElementById('urlPreview').classList.add('empty');
                clearQRCode();
                return;
            }

            // Build UTM URL
            const url = new URL(baseUrl);
            if (campaign) url.searchParams.set('utm_campaign', campaign);
            if (source) url.searchParams.set('utm_source', source);
            if (medium) url.searchParams.set('utm_medium', medium);
            if (term) url.searchParams.set('utm_term', term);
            if (content) url.searchParams.set('utm_content', content);
            if (customParam) url.searchParams.set('custom', customParam);

            const finalUrl = url.toString();

            // Update preview
            document.getElementById('urlPreview').textContent = finalUrl;
            document.getElementById('urlPreview').classList.remove('empty');
            
            // Update character count
            document.getElementById('urlLength').textContent = finalUrl.length;

            // Generate QR code
            generateQRCode(finalUrl);

            // Animate preview update
            gsap.from('#urlPreview', {duration: 0.3, y: 10, opacity: 0});
        }

        function generateQRCode(url) {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            if (url && url !== 'Enter your campaign details to see the UTM URL preview') {
                QRCode.toCanvas(qrContainer, url, {
                    width: 200,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#ffffff'
                    }
                }, function (error) {
                    if (error) console.error(error);
                    currentQR = qrContainer.querySelector('canvas');
                });
            }
        }

        function clearQRCode() {
            document.getElementById('qrcode').innerHTML = '';
            currentQR = null;
        }

        function copyUrl() {
            const urlText = document.getElementById('urlPreview').textContent;
            if (urlText && !urlText.includes('Enter your campaign')) {
                navigator.clipboard.writeText(urlText).then(() => {
                    showNotification('URL copied to clipboard!');
                    saveToHistory(urlText);
                    animateButton(event.target);
                });
            }
        }

        function shareUrl() {
            const urlText = document.getElementById('urlPreview').textContent;
            if (urlText && !urlText.includes('Enter your campaign')) {
                if (navigator.share) {
                    navigator.share({
                        title: 'UTM Tracked URL',
                        url: urlText
                    });
                } else {
                    copyUrl();
                }
                animateButton(event.target);
            }
        }

        function downloadQR() {
            if (currentQR) {
                const link = document.createElement('a');
                link.download = 'utm-qr-code.png';
                link.href = currentQR.toDataURL();
                link.click();
                showNotification('QR code downloaded!');
                animateButton(event.target);
            }
        }

        function saveToHistory(url) {
            const campaign = document.getElementById('campaign').value;
            const source = document.getElementById('source').value;
            const medium = document.getElementById('medium').value;
            
            const historyItem = {
                url: url,
                campaign: campaign,
                source: source,
                medium: medium,
                timestamp: new Date().toISOString(),
                clicks: 0
            };

            urlHistory.unshift(historyItem);
            urlHistory = urlHistory.slice(0, 50); // Keep only 50 recent URLs
            
            localStorage.setItem('utmHistory', JSON.stringify(urlHistory));
            
            // Update stats
            stats.urlCount++;
            if (campaign && !urlHistory.slice(1).some(item => item.campaign === campaign)) {
                stats.campaignCount++;
            }
            localStorage.setItem('utmStats', JSON.stringify(stats));
            
            updateStats();
            loadHistory();
        }

        function loadHistory() {
            const container = document.getElementById('historyContainer');
            container.innerHTML = '';

            urlHistory.slice(0, 10).forEach((item, index) => {
                const historyDiv = document.createElement('div');
                historyDiv.className = 'history-item';
                historyDiv.innerHTML = `
                    <div class="history-url">${item.url}</div>
                    <div class="history-meta">
                        <span>${item.campaign} ‚Ä¢ ${item.source} ‚Ä¢ ${item.medium}</span>
                        <span>${new Date(item.timestamp).toLocaleDateString()}</span>
                    </div>
                `;
                historyDiv.onclick = () => {
                    navigator.clipboard.writeText(item.url);
                    showNotification('Historical URL copied!');
                    animateButton(historyDiv);
                };
                container.appendChild(historyDiv);

                // Animate history item
                gsap.from(historyDiv, {duration: 0.3, x: -20, opacity: 0, delay: index * 0.1});
            });
        }

        function clearHistory() {
            urlHistory = [];
            localStorage.removeItem('utmHistory');
            loadHistory();
            showNotification('History cleared!');
            animateButton(event.target);
        }

        function updateStats() {
            document.getElementById('urlCount').textContent = stats.urlCount;
            document.getElementById('campaignCount').textContent = stats.campaignCount;
        }

        function generateBulkUrls() {
            const bulkInput = document.getElementById('bulkUrls').value;
            const urls = bulkInput.split('\n').filter(url => url.trim());
            
            if (urls.length === 0) {
                showNotification('Please enter URLs for bulk generation', 'warning');
                return;
            }

            const campaign = document.getElementById('campaign').value;
            const source = document.getElementById('source').value;
            const medium = document.getElementById('medium').value;
            const term = document.getElementById('term').value;
            const content = document.getElementById('content').value;

            const results = urls.map(baseUrl => {
                try {
                    const url = new URL(baseUrl.trim());
                    if (campaign) url.searchParams.set('utm_campaign', campaign);
                    if (source) url.searchParams.set('utm_source', source);
                    if (medium) url.searchParams.set('utm_medium', medium);
                    if (term) url.searchParams.set('utm_term', term);
                    if (content) url.searchParams.set('utm_content', content);
                    return url.toString();
                } catch (e) {
                    return `Invalid URL: ${baseUrl}`;
                }
            });

            // Display results in a modal-like overlay
            showBulkResults(results);
            showNotification(`Generated ${results.length} UTM URLs!`);
        }

        function showBulkResults(results) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                backdrop-filter: blur(10px);
            `;

            const content = document.createElement('div');
            content.style.cssText = `
                background: var(--surface);
                border: 1px solid var(--border);
                border-radius: 20px;
                padding: 30px;
                max-width: 80%;
                max-height: 80%;
                overflow-y: auto;
                position: relative;
            `;

            content.innerHTML = `
                <h2 style="margin-bottom: 20px; color: var(--text);">Bulk Generated URLs</h2>
                <div style="margin-bottom: 20px;">
                    ${results.map(url => `
                        <div style="
                            background: var(--background);
                            border: 1px solid var(--border);
                            border-radius: 8px;
                            padding: 10px;
                            margin-bottom: 10px;
                            font-family: monospace;
                            font-size: 0.9rem;
                            word-break: break-all;
                            color: var(--text);
                        ">${url}</div>
                    `).join('')}
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="copyBulkResults('${results.join('\\n')}')">Copy All</button>
                    <button class="btn btn-secondary" onclick="document.body.removeChild(this.closest('div[style*=\"position: fixed\"]'))">Close</button>
                </div>
            `;

            modal.appendChild(content);
            document.body.appendChild(modal);

            // Animate modal
            gsap.from(modal, {duration: 0.3, opacity: 0});
            gsap.from(content, {duration: 0.3, scale: 0.8, delay: 0.1});
        }

        function copyBulkResults(results) {
            navigator.clipboard.writeText(results).then(() => {
                showNotification('All URLs copied to clipboard!');
            });
        }

        function exportCSV() {
            if (urlHistory.length === 0) {
                showNotification('No URLs in history to export', 'warning');
                return;
            }

            const headers = ['URL', 'Campaign', 'Source', 'Medium', 'Date Created'];
            const csvContent = [
                headers.join(','),
                ...urlHistory.map(item => [
                    `"${item.url}"`,
                    item.campaign,
                    item.source,
                    item.medium,
                    new Date(item.timestamp).toLocaleDateString()
                ].join(','))
            ].join('\n');

            downloadFile(csvContent, 'utm-urls.csv', 'text/csv');
            showNotification('CSV exported successfully!');
            animateButton(event.target);
        }

        function exportJSON() {
            if (urlHistory.length === 0) {
                showNotification('No URLs in history to export', 'warning');
                return;
            }

            const jsonContent = JSON.stringify({
                exportDate: new Date().toISOString(),
                totalUrls: urlHistory.length,
                urls: urlHistory
            }, null, 2);

            downloadFile(jsonContent, 'utm-urls.json', 'application/json');
            showNotification('JSON exported successfully!');
            animateButton(event.target);
        }

        function exportPDF() {
            // For a real implementation, you'd use a library like jsPDF
            // This is a simplified version that creates a text file with PDF-like formatting
            if (urlHistory.length === 0) {
                showNotification('No URLs in history to export', 'warning');
                return;
            }

            const pdfContent = `
UTM URL REPORT
Generated: ${new Date().toLocaleDateString()}
Total URLs: ${urlHistory.length}

${urlHistory.map((item, index) => `
${index + 1}. ${item.campaign}
   URL: ${item.url}
   Source: ${item.source}
   Medium: ${item.medium}
   Created: ${new Date(item.timestamp).toLocaleDateString()}
`).join('\n')}
            `.trim();

            downloadFile(pdfContent, 'utm-report.txt', 'text/plain');
            showNotification('Report exported successfully!');
            animateButton(event.target);
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            const button = event.target;
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                button.textContent = '‚öôÔ∏è Advanced Options';
            } else {
                content.classList.add('show');
                button.textContent = '‚öôÔ∏è Hide Advanced Options';
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function animateButton(button) {
            gsap.to(button, {duration: 0.1, scale: 0.95, yoyo: true, repeat: 1});
        }

        function createFloatingParticles() {
            const container = document.querySelector('.floating-particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                container.appendChild(particle);

                // Animate particles
                gsap.to(particle, {
                    duration: Math.random() * 10 + 10,
                    x: (Math.random() - 0.5) * 200,
                    y: (Math.random() - 0.5) * 200,
                    rotation: Math.random() * 360,
                    repeat: -1,
                    yoyo: true,
                    ease: "none"
                });

                gsap.to(particle, {
                    duration: Math.random() * 3 + 2,
                    opacity: Math.random() * 0.7 + 0.3,
                    repeat: -1,
                    yoyo: true,
                    ease: "power2.inOut"
                });
            }
        }

        // Advanced features for enterprise use
        function initializeAdvancedFeatures() {
            // URL shortening simulation
            const urlShortener = document.createElement('div');
            urlShortener.className = 'url-shortener';
            urlShortener.innerHTML = `
                <h4 style="margin-bottom: 10px; color: var(--text);">URL Shortening</h4>
                <button class="btn btn-secondary" onclick="shortenUrl()" style="width: 100%;">Create Short URL</button>
                <div id="shortUrl" style="margin-top: 10px; font-family: monospace; color: var(--text-secondary);"></div>
            `;
            
            document.querySelector('.preview-section').appendChild(urlShortener);
        }

        function shortenUrl() {
            const originalUrl = document.getElementById('urlPreview').textContent;
            if (originalUrl && !originalUrl.includes('Enter your campaign')) {
                // Simulate URL shortening
                const shortCode = Math.random().toString(36).substring(2, 8);
                const shortUrl = `https://utm.ly/${shortCode}`;
                document.getElementById('shortUrl').textContent = shortUrl;
                showNotification('Short URL created!');
            }
        }

        // A/B Testing URL variants
        function createABTestUrls() {
            const baseUrl = document.getElementById('baseUrl').value;
            const campaign = document.getElementById('campaign').value;
            
            if (!baseUrl || !campaign) {
                showNotification('Please enter base URL and campaign name', 'warning');
                return;
            }

            const variants = ['A', 'B'];
            const results = variants.map(variant => {
                const url = new URL(baseUrl);
                url.searchParams.set('utm_campaign', `${campaign}_${variant}`);
                url.searchParams.set('utm_source', document.getElementById('source').value);
                url.searchParams.set('utm_medium', document.getElementById('medium').value);
                url.searchParams.set('utm_content', `variant_${variant}`);
                return url.toString();
            });

            showBulkResults(results);
            showNotification('A/B test URLs generated!');
        }

        // Initialize advanced features
        setTimeout(() => {
            initializeAdvancedFeatures();
        }, 1000);

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'c':
                        if (e.shiftKey) {
                            e.preventDefault();
                            copyUrl();
                        }
                        break;
                    case 'Enter':
                        e.preventDefault();
                        updatePreview();
                        break;
                }
            }
        });

        // Auto-save form data
        function autoSave() {
            const formData = {
                baseUrl: document.getElementById('baseUrl').value,
                campaign: document.getElementById('campaign').value,
                source: document.getElementById('source').value,
                medium: document.getElementById('medium').value,
                term: document.getElementById('term').value,
                content: document.getElementById('content').value,
                customParam: document.getElementById('customParam').value
            };
            localStorage.setItem('utmFormData', JSON.stringify(formData));
        }

        function loadSavedData() {
            const savedData = JSON.parse(localStorage.getItem('utmFormData') || '{}');
            Object.keys(savedData).forEach(key => {
                const element = document.getElementById(key);
                if (element && savedData[key]) {
                    element.value = savedData[key];
                }
            });
        }

        // Load saved data on page load
        setTimeout(loadSavedData, 100);

        // Auto-save every 5 seconds
        setInterval(autoSave, 5000);

        // Performance monitoring
        let performanceMetrics = {
            urlsGenerated: 0,
            averageGenerationTime: 0,
            totalTime: 0
        };

        function trackPerformance(startTime) {
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            performanceMetrics.urlsGenerated++;
            performanceMetrics.totalTime += duration;
            performanceMetrics.averageGenerationTime = performanceMetrics.totalTime / performanceMetrics.urlsGenerated;
            
            console.log(`URL generated in ${duration.toFixed(2)}ms`);
        }

        // Enhanced URL validation
        function validateUrl(url) {
            try {
                const urlObj = new URL(url);
                return {
                    valid: true,
                    protocol: urlObj.protocol,
                    domain: urlObj.hostname,
                    hasParams: urlObj.search.length > 0
                };
            } catch (e) {
                return {
                    valid: false,
                    error: 'Invalid URL format'
                };
            }
        }

        // Team collaboration features
        function shareWithTeam() {
            const urlData = {
                url: document.getElementById('urlPreview').textContent,
                campaign: document.getElementById('campaign').value,
                source: document.getElementById('source').value,
                medium: document.getElementById('medium').value,
                createdBy: 'Current User',
                createdAt: new Date().toISOString()
            };

            // In a real app, this would send to a backend
            const shareableLink = `data:application/json;base64,${btoa(JSON.stringify(urlData))}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'UTM Campaign',
                    text: `Campaign: ${urlData.campaign}`,
                    url: shareableLink
                });
            } else {
                copyUrl();
                showNotification('Campaign data copied for team sharing!');
            }
        }

        // Add team sharing button
        setTimeout(() => {
            const teamButton = document.createElement('button');
            teamButton.className = 'btn btn-secondary';
            teamButton.innerHTML = 'üë• Share with Team';
            teamButton.onclick = shareWithTeam;
            teamButton.style.width = '100%';
            teamButton.style.marginTop = '10px';
            
            document.querySelector('.export-options').appendChild(teamButton);
        }, 1500);
    </script>
</body>
</html>